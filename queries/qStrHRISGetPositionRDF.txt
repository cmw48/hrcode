#
# qStrHRISGetPositionRDF.txt
# updated 140623 - changed newhr > hr
# queries HRIS for all details related to a position
# TODO:  fix this to pull only HR Graph rdf and adjust output
# changed 121003 to add end date where available
# removed optionals 121115 and noted that enddate was 
# construct, commented for now
# made primaryUnitCode optional 130303

PREFIX hr: <http://vivo.cornell.edu/ns/hr/0.9/hr.owl#>  
PREFIX cuvivo: <http://vivo.cornell.edu/individual/> 
PREFIX foaf: <http://xmlns.com/foaf/0.1/> 
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> 
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> 
PREFIX vivo: <http://vivoweb.org/ontology/core#> 
PREFIX titlemap: <http://vivo.library.cornell.edu/ns/hr/titleMapping#> 

CONSTRUCT {
      ?job hr:company ?hrpPosnCompany .
      ?job hr:dLevelCode ?hrpDLevelCode .
      ?job hr:dLevelOrgName ?hrpDLevelOrgName .
      ?job hr:jobCode ?hrpJobCode .
      ?job hr:jobFamily ?hrpJobFamily .
      ?job hr:jobFamilyGroup ?hrpJobFamilyGroup .
      ?job hr:kfsOrgCode ?hrpKfsOrgCode .
      ?job hr:positionForJob ?hrpPositionForJob .
      ?job hr:supOrgCode ?hrpSupOrgCode .
      ?job vivo:positionInOrganization ?hrpPosnInOrganization .
      ?job rdfs:label ?hrjLabel .
      ?job hr:jobId ?hrjJobId .
      ?job hr:jobInPosition ?hrjJobInPosition .
      ?job hr:primaryJob ?hrjPrimaryJob .
      ?job hr:startDate ?hrjStartDate .
      ?job vivo:hrJobTitle ?hrjHrJobTitle .
      ?job vivo:jobForPerson ?hrjJobForPerson .
}
WHERE
{
  # querying HRIS endpoint
  # get Workday->D2R format rdf, then write it as vivo 1.6 format rdf.
  SERVICE <http://vivo-migrate.library.cornell.edu/d2r>
    {
      # list all position-specific RDF
      VARVALUE hr:company ?hrpPosnCompany .
      VARVALUE hr:dLevelCode ?hrpDLevelCode .
      VARVALUE hr:dLevelOrgName ?hrpDLevelOrgName .
      VARVALUE hr:jobCode ?hrpJobCode .
      VARVALUE hr:jobFamily ?hrpJobFamily .
      VARVALUE hr:jobFamilyGroup ?hrpJobFamilyGroup .
      VARVALUE hr:kfsOrgCode ?hrpKfsOrgCode .
      VARVALUE hr:positionForJob ?job .
      VARVALUE hr:supOrgCode ?hrpSupOrgCode .
      VARVALUE vivo:positionInOrganization ?hrpPosnInOrganization .

      #then, list all job-specific RDF
      ?job rdfs:label ?hrjLabel .
      ?job hr:jobId ?hrjJobId .
      ?job hr:jobInPosition ?hrjJobInPosition .
      ?job hr:primaryJob ?hrjPrimaryJob .
      ?job hr:startDate ?hrjStartDate .
      ?job vivo:hrJobTitle ?hrjHrJobTitle .
      ?job vivo:jobForPerson ?hrjJobForPerson .


     } 
}